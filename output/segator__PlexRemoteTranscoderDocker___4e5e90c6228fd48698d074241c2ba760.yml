PlexMainServer:
  environment:
    VERSION: plexpass
  image: segator/plex
  volumes:
  #volumes where we have moves tvshows homemade videos music etc..
  - /server/media/movies:/data/movies:ro
  - /server/media/tvshows:/data/tvshows:ro
  #Volume where we save our plex database
  - /server/docker/plex/config/:/config
    
  #Volume used to store temporal files generated by transcoder (we must configure plex from the web ui to save temporals to /transcode)
  - /server/docker/plex/transcode:/transcode
  net: host
plexTranscoderOrchestrator:
  ports:
  - 8800:8800/tcp
  - 111:111/udp
  - 2049:2049/tcp
  - 111:111/tcp
  - 15300:15300/tcp
  - 15300:15300/udp
  environment:  
    #Domain used by DigitalOcean to transfer transcoded video to your Plex Server
    PUBLIC_DOMAIN: my.public.domain.com
    #Port used by DigitalOcean to transfer transcoded video to your Plex Server
    PLEX_PUBLIC_PORT: '32400'
    #this is where you want to deploy DigitalOcean machines(use the nearest from your plex server location)
    DO_REGION: ams2 
    #This is your digitalOcean admin token
    DO_TOKEN: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    #This is the ssh key used by the DO VM to autoconnect using SSH 
    SSH_PUB_KEY_PATH: /config/.ssh/id_rsa.pub
    #same as PLEX_PUBLIC_PORT but this port is for DO machines notification of their current status
    ORCHESTRATOR_PUBLIC_PORT: '8800'
    #Where is the movies tvshows
    MEDIA_DIRECTORY: /data
    #In seconds, when the transcoder it's not used in this time, will be destroyed
    TRANSCODER_TIMEOUT: 600
  image: segator/plextranscoderorchestrator
  links:
  - PlexMainServer:plex
  privileged: true
  volumes_from:
  - PlexMainServer
